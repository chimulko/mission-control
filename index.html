<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mission Control ‚Äî Chumi</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* =========================
       THEME VARIABLES
    ========================== */
    :root {
      --bg: #050508;
      --bg-soft: #0d0d14;
      --card: rgba(255, 255, 255, 0.05);
      --card-strong: rgba(255, 255, 255, 0.08);
      --text: #f5f5ff;
      --muted: #a5a6b8;
      --line: rgba(255,255,255,0.06);
      --accent: #8B5CF6;
      --accent-soft: rgba(139, 92, 246, 0.20);
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;

      --radius: 16px;
      --radius-sm: 12px;
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.35);

      --space-1: 0.5rem;
      --space-2: 0.75rem;
      --space-3: 1rem;
      --space-4: 1.5rem;
      --space-5: 2rem;
      --space-6: 2.5rem;
    }

    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top right, rgba(139,92,246,0.16), transparent 30%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      max-width: 1600px;
      margin: 0 auto;
      padding: var(--space-6);
    }

    /* =========================
       HEADER
    ========================== */
    .header {
      position: sticky;
      top: 0;
      z-index: 30;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 1rem;
      margin: 0 auto var(--space-5);
      padding: 0.85rem 1rem;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(10, 10, 15, 0.65);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 700;
    }

    .brand-logo {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: grid;
      place-items: center;
      background: linear-gradient(135deg, var(--accent), #6d28d9);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.4);
    }

    .tabs {
      display: flex;
      gap: 0.5rem;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--line);
      padding: 0.35rem;
      border-radius: 999px;
      justify-self: center;
    }

    .tab-btn {
      border: 0;
      color: var(--muted);
      background: transparent;
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      transition: all 0.25s ease;
      font-weight: 600;
    }

    .tab-btn.active {
      color: #fff;
      background: var(--accent-soft);
      box-shadow: inset 0 0 0 1px rgba(139, 92, 246, 0.4);
    }

    .header-right {
      display: flex;
      justify-self: end;
      align-items: center;
      gap: 0.7rem;
    }

    .search {
      width: min(300px, 45vw);
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      border-radius: 10px;
      padding: 0.55rem 0.8rem;
      outline: none;
      transition: border-color 0.25s ease, box-shadow 0.25s ease;
    }

    .search:focus {
      border-color: rgba(139,92,246,0.6);
      box-shadow: 0 0 0 3px rgba(139,92,246,0.18);
    }

    .status-wrap {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
      animation: pulse 1.8s infinite;
    }

    /* =========================
       SHARED UI
    ========================== */
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }

    .card {
      border: 1px solid var(--line);
      background: var(--card);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      animation: fadeInUp 0.5s ease both;
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .card:hover { border-color: rgba(139,92,246,0.4); }

    .section-title {
      margin: 0 0 var(--space-3);
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .button {
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      border-radius: 10px;
      padding: 0.45rem 0.75rem;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .button:hover {
      border-color: rgba(139,92,246,0.5);
      background: rgba(139,92,246,0.15);
    }

    .muted { color: var(--muted); }

    /* =========================
       DASHBOARD
    ========================== */
    .welcome-bar {
      padding: 1.1rem 1.2rem;
      margin-bottom: var(--space-4);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 1rem;
      margin-bottom: var(--space-4);
    }

    .metric {
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }

    .metric::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), #a78bfa);
    }

    .metric .top {
      display: flex;
      justify-content: space-between;
      color: var(--muted);
    }

    .metric .value {
      margin: 0.6rem 0 0.2rem;
      font-size: 1.8rem;
      font-weight: 800;
      letter-spacing: -0.02em;
    }

    .trend.up { color: var(--success); }
    .trend.down { color: var(--danger); }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 1rem;
    }

    .feed {
      max-height: 380px;
      overflow: auto;
      padding: 1rem;
    }

    .feed-item {
      padding: 0.7rem;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: rgba(255,255,255,0.02);
      margin-bottom: 0.55rem;
    }

    .priority-list {
      padding: 1rem;
    }

    .priority-item {
      display: flex;
      gap: 0.6rem;
      align-items: center;
      margin-bottom: 0.6rem;
    }

    .priority-input {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      color: var(--text);
      padding: 0.5rem 0.65rem;
    }

    /* =========================
       PROJECTS / KANBAN
    ========================== */
    .kanban {
      display: grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 1rem;
    }

    .kanban-col {
      padding: 0.9rem;
      min-height: 420px;
    }

    .kanban-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.8rem;
    }

    .task {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(255,255,255,0.03);
      padding: 0.75rem;
      margin-bottom: 0.65rem;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .task:hover { transform: translateY(-2px); border-color: rgba(139,92,246,0.45); }
    .task h4 { margin: 0 0 0.35rem; font-size: 0.95rem; }
    .task p { margin: 0 0 0.5rem; color: var(--muted); font-size: 0.86rem; }

    .task-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .badge { padding: 0.2rem 0.5rem; border-radius: 999px; font-weight: 600; }
    .badge.high { background: rgba(239,68,68,.2); color: #fca5a5; }
    .badge.medium { background: rgba(245,158,11,.2); color: #fcd34d; }
    .badge.low { background: rgba(34,197,94,.2); color: #86efac; }

    /* =========================
       TIMELINE
    ========================== */
    .timeline {
      position: relative;
      margin-left: 0.5rem;
      padding-left: 1.4rem;
      border-left: 2px solid rgba(139,92,246,0.35);
    }

    .phase {
      position: relative;
      margin-bottom: 1rem;
      padding: 1rem;
    }

    .phase::before {
      content: "";
      position: absolute;
      left: -1.95rem;
      top: 1.1rem;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 0 5px rgba(139,92,246,0.2);
    }

    .phase.current {
      border-color: rgba(139,92,246,0.5);
      box-shadow: 0 0 24px rgba(139,92,246,0.25), var(--shadow);
    }

    .milestones { margin: 0.55rem 0 0; padding-left: 1rem; }
    .milestones li { margin-bottom: 0.35rem; color: var(--muted); }

    /* =========================
       NOTES
    ========================== */
    .notes-wrap { padding: 1rem; }
    textarea#notesInput {
      width: 100%;
      min-height: 420px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      padding: 1rem;
      resize: vertical;
      outline: none;
      line-height: 1.5;
    }

    .notes-meta {
      margin-top: 0.55rem;
      display: flex;
      justify-content: space-between;
      color: var(--muted);
      font-size: 0.85rem;
    }

    /* =========================
       REVENUE
    ========================== */
    .revenue-grid {
      display: grid;
      grid-template-columns: 1fr 1.2fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .revenue-goal-card,.revenue-chart-card,.revenue-clients-card,.revenue-projection-card { padding: 1rem; }
    .goal-row { display:flex; gap:1rem; align-items:center; }
    .goal-gauge-wrap { display:grid; place-items:center; }
    .goal-gauge {
      --deg: 0deg;
      width: 150px; height: 150px; border-radius: 50%;
      display:grid; place-items:center;
      background: conic-gradient(var(--accent) var(--deg), rgba(255,255,255,0.08) 0deg);
      position: relative;
      box-shadow: 0 0 25px rgba(139,92,246,0.25);
      font-weight: 700;
    }
    .goal-gauge::after { content:""; position:absolute; inset:10px; border-radius:50%; background: rgba(7,7,11,0.95); border:1px solid var(--line); }
    .goal-gauge span { position:relative; z-index:1; }
    .goal-controls { flex:1; display:grid; gap:.6rem; }
    .clients-list { display:grid; gap:.6rem; }
    .client-row {
      border:1px solid var(--line); border-radius:12px; padding:.75rem;
      display:grid; grid-template-columns: 1.3fr .8fr .8fr .9fr auto; gap:.6rem; align-items:center;
      background: rgba(255,255,255,0.03);
    }
    .status-pill { padding:.2rem .5rem; border-radius:999px; font-size:.78rem; font-weight:600; width:max-content; }
    .status-pill.active { background: rgba(34,197,94,.2); color:#86efac; }
    .status-pill.pending { background: rgba(245,158,11,.2); color:#fcd34d; }
    .status-pill.churned { background: rgba(239,68,68,.2); color:#fca5a5; }
    .projection-grid { display:grid; grid-template-columns: repeat(3,minmax(0,1fr)); gap:.8rem; }
    .projection-item { border:1px solid var(--line); border-radius:12px; padding:.8rem; background: rgba(255,255,255,.03); }
    .projection-item h3 { margin:.4rem 0 0; }

    /* =========================
       COMMAND CENTER
    ========================== */
    .command-center-card,.decisions-card { padding: 1rem; margin-bottom: 1rem; }
    .agents-grid { display:grid; grid-template-columns: repeat(4,minmax(0,1fr)); gap:.8rem; }
    .agent-card { border:1px solid var(--line); border-radius:12px; background: rgba(255,255,255,.03); padding:.8rem; cursor:pointer; transition:.2s ease; }
    .agent-card:hover { transform: translateY(-2px); border-color: rgba(139,92,246,.45); }
    .agent-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:.35rem; }
    .agent-role { color: var(--muted); font-size:.86rem; margin-bottom:.5rem; }
    .agent-meta { display:flex; justify-content:space-between; color: var(--muted); font-size:.78rem; }
    .agent-status { display:flex; align-items:center; gap:.35rem; font-size:.8rem; text-transform:capitalize; }
    .dot { width:8px; height:8px; border-radius:50%; }
    .dot.online { background:#22c55e; box-shadow:0 0 10px rgba(34,197,94,.8); }
    .dot.busy { background:#f59e0b; box-shadow:0 0 10px rgba(245,158,11,.8); }
    .dot.offline { background:#6b7280; box-shadow:0 0 10px rgba(107,114,128,.6); }
    .agent-panel { position: fixed; right: 0; top: 0; height: 100vh; width: min(460px,95vw); border-left:1px solid var(--line); background: rgba(9,9,14,.96); backdrop-filter: blur(12px); padding: 1rem; box-shadow: -12px 0 40px rgba(0,0,0,.45); transform: translateX(100%); transition: transform .25s ease; z-index: 60; overflow:auto; }
    .agent-panel.open { transform: translateX(0); }
    .agent-panel-head { display:flex; justify-content:space-between; align-items:center; }
    .panel-list { margin-top:.2rem; padding-left:1rem; color:var(--muted); }
    .panel-log { display:grid; gap:.45rem; }
    .panel-log-item { border:1px solid var(--line); border-radius:10px; padding:.55rem; background: rgba(255,255,255,.03); }
    .panel-notes { border:1px solid var(--line); border-radius:10px; padding:.6rem; background: rgba(255,255,255,.03); color:var(--muted); }
    .decision-item { border:1px solid var(--line); border-radius:12px; background: rgba(255,255,255,.03); padding:.75rem; margin-bottom:.6rem; }
    .decision-item small { color:var(--muted); }

    /* =========================
       YOUTUBE
    ========================== */
    .yt-ideas-card,.yt-growth-card,.yt-calendar-card { padding: 1rem; }
    .yt-ideas-card { margin-bottom: 1rem; }
    .yt-pipeline { display:grid; grid-template-columns: repeat(5,minmax(0,1fr)); gap:.8rem; }
    .yt-col { border:1px solid var(--line); border-radius:12px; background: rgba(255,255,255,.03); padding:.65rem; min-height: 200px; }
    .yt-col-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:.55rem; }
    .yt-col h4 { margin:.2rem 0; font-size:.9rem; text-transform: capitalize; }
    .idea-card { border:1px solid var(--line); border-radius:10px; background: rgba(255,255,255,.03); padding:.55rem; margin-bottom:.45rem; cursor:pointer; }
    .idea-card:hover { border-color: rgba(139,92,246,.45); }
    .idea-card p { margin:.2rem 0; color: var(--muted); font-size:.82rem; }
    .idea-card small { color: var(--muted); font-size:.74rem; }

    .yt-growth-grid { display:grid; grid-template-columns: 1fr 1.2fr; gap:1rem; }
    .yt-growth-controls { display:grid; gap:.6rem; margin-bottom:.8rem; }
    .xp-wrap { display:grid; gap:.35rem; }
    .xp-bar { width:100%; height:12px; border-radius:999px; background: rgba(255,255,255,.08); overflow:hidden; border:1px solid var(--line); }
    #xpBarFill { width:0%; height:100%; background: linear-gradient(90deg, var(--accent), #a78bfa); box-shadow: 0 0 20px rgba(139,92,246,.35); transition: width .3s ease; }

    .yt-calendar-grid { display:grid; grid-template-columns: repeat(7,minmax(0,1fr)); gap:.35rem; }
    .yt-day { border:1px solid var(--line); border-radius:10px; min-height:64px; padding:.35rem; background: rgba(255,255,255,.02); font-size:.78rem; }
    .yt-day .d { color: var(--muted); font-size:.72rem; }
    .yt-day.has-video { border-color: rgba(139,92,246,.45); box-shadow: inset 0 0 0 1px rgba(139,92,246,.2); }
    .yt-day .v { margin-top:.25rem; font-size:.7rem; color:#d6c9ff; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* =========================
       MEETINGS
    ========================== */
    .meetings-today-card,.meetings-upcoming-card,.meetings-past-card { padding: 1rem; margin-bottom: 1rem; }
    .meeting-card {
      border: 1px solid var(--line);
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      padding: .75rem;
      margin-bottom: .65rem;
    }
    .meeting-card.today { border-color: rgba(139,92,246,.55); box-shadow: 0 0 16px rgba(139,92,246,.2); }
    .meeting-head { display:flex; justify-content:space-between; align-items:flex-start; gap:.8rem; }
    .meeting-meta { display:flex; gap:.4rem; flex-wrap:wrap; margin-top:.3rem; }
    .meeting-pill { font-size:.74rem; padding:.2rem .5rem; border-radius:999px; border:1px solid var(--line); color: var(--muted); }
    .countdown { color:#d9c9ff; font-weight:600; font-size:.82rem; }
    .meeting-actions { display:flex; gap:.45rem; }
    .meeting-expand {
      margin-top:.65rem;
      padding-top:.6rem;
      border-top:1px dashed var(--line);
      display:none;
    }
    .meeting-expand.open { display:block; }
    .agenda-list { display:grid; gap:.35rem; margin:.45rem 0; }
    .agenda-item { display:flex; gap:.5rem; align-items:center; }
    .agenda-item input[type="text"] { flex:1; }
    .meeting-textarea { width:100%; min-height:80px; border:1px solid var(--line); border-radius:10px; background: rgba(255,255,255,.03); color:var(--text); padding:.5rem; }

    /* =========================
       MODAL
    ========================== */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(0,0,0,0.6);
      z-index: 50;
      padding: 1rem;
    }

    .modal-backdrop.open { display: grid; }

    .modal {
      width: min(580px, 100%);
      padding: 1rem;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: rgba(14,14,20,0.95);
      box-shadow: var(--shadow);
    }

    .modal .field { margin-bottom: 0.7rem; }
    .modal label { display: block; margin-bottom: 0.3rem; color: var(--muted); font-size: 0.85rem; }

    .modal input, .modal textarea, .modal select {
      width: 100%;
      border: 1px solid var(--line);
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      color: var(--text);
      padding: 0.55rem 0.65rem;
    }

    .modal-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      margin-top: 0.8rem;
    }

    .button.danger { border-color: rgba(239,68,68,.5); color: #fda4af; }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.35); opacity: 0.75; }
    }

    @media (max-width: 1180px) {
      .header { grid-template-columns: 1fr; }
      .tabs { justify-self: start; }
      .header-right { justify-self: start; }
      .metrics { grid-template-columns: repeat(2, minmax(0,1fr)); }
      .dashboard-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 760px) {
      .app-shell { padding: 1rem; }
      .metrics { grid-template-columns: 1fr; }
      .kanban { grid-template-columns: 1fr; }
      .search { width: 100%; }
      .header-right { width: 100%; }
      .revenue-grid, .projection-grid, .agents-grid, .yt-growth-grid { grid-template-columns: 1fr; }
      .yt-pipeline { grid-template-columns: 1fr; }
      .yt-calendar-grid { grid-template-columns: repeat(4,minmax(0,1fr)); }
      .client-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="header card">
      <div class="brand">
        <div class="brand-logo">üöÄ</div>
        <div>
          <div>Mission Control</div>
          <small class="muted">Le Funk ‚Äî Socio</small>
        </div>
      </div>

      <nav class="tabs" id="tabsNav">
        <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
        <button class="tab-btn" data-tab="projects">üìã Projects</button>
        <button class="tab-btn" data-tab="timeline">üìÖ Timeline</button>
        <button class="tab-btn" data-tab="revenue">üí∞ Revenue</button>
        <button class="tab-btn" data-tab="command">üè¢ Command Center</button>
        <button class="tab-btn" data-tab="youtube">üé¨ YouTube</button>
        <button class="tab-btn" data-tab="meetings">üìû Meetings</button>
        <button class="tab-btn" data-tab="notes">üìù Notes</button>
      </nav>

      <div class="header-right">
        <input id="searchInput" class="search" placeholder="Search everything‚Ä¶ (‚åò/Ctrl+K)" />
        <div class="status-wrap"><span class="status-dot"></span>Online</div>
      </div>
    </header>

    <main>
      <!-- DASHBOARD TAB -->
      <section class="tab-pane active" id="tab-dashboard">
        <div class="welcome-bar card">
          <div>
            <h2 id="welcomeText" style="margin:0;">Good evening, Chumi</h2>
            <div class="muted" id="liveDateTime"></div>
          </div>
          <div class="muted">Main Goal: <strong style="color:#fff">Desarrollar un PM by En un mes</strong></div>
        </div>

        <div class="metrics">
          <article class="metric card">
            <div class="top"><span>üéØ MVP funcional</span><span class="trend up" id="mvpTrend">+0%</span></div>
            <div class="value" id="mvpValue">0%</div>
            <small class="muted">Target completion progress</small>
          </article>
          <article class="metric card">
            <div class="top"><span>üìÅ Active Projects</span><span class="trend up">Live</span></div>
            <div class="value" id="projectsValue">0</div>
            <small class="muted">Tasks in backlog + in progress</small>
          </article>
          <article class="metric card">
            <div class="top"><span>‚úÖ Tasks Today</span><span class="trend up" id="tasksTrend">+0</span></div>
            <div class="value" id="tasksTodayValue">0</div>
            <small class="muted">Items completed today</small>
          </article>
          <article class="metric card">
            <div class="top"><span>‚è≥ Days to Goal</span><span class="trend down">Countdown</span></div>
            <div class="value" id="daysGoalValue">30</div>
            <small class="muted">Until one-month target</small>
          </article>
        </div>

        <div class="dashboard-grid">
          <section class="card">
            <div class="section-title" style="padding:1rem 1rem 0;">
              <span>Recent Activity</span>
            </div>
            <div class="feed" id="activityFeed"></div>
          </section>

          <section class="card">
            <div class="section-title" style="padding:1rem 1rem 0;">
              <span>Top Priorities</span>
              <button class="button" id="addPriorityBtn">+ Add Priority</button>
            </div>
            <div class="priority-list" id="priorityList"></div>
          </section>
        </div>
      </section>

      <!-- PROJECTS TAB -->
      <section class="tab-pane" id="tab-projects">
        <div class="kanban" id="kanbanBoard"></div>
      </section>

      <!-- TIMELINE TAB -->
      <section class="tab-pane" id="tab-timeline">
        <div class="timeline" id="timelineContainer"></div>
      </section>

      <!-- REVENUE TAB -->
      <section class="tab-pane" id="tab-revenue">
        <div class="revenue-grid">
          <section class="card revenue-goal-card">
            <div class="section-title"><span>Monthly Revenue Goal</span></div>
            <div class="goal-row">
              <div class="goal-gauge-wrap">
                <div class="goal-gauge" id="goalGauge"><span id="goalGaugeLabel">0%</span></div>
              </div>
              <div class="goal-controls">
                <label class="muted">Goal (Monthly)</label>
                <input id="revenueGoalInput" type="number" min="0" step="100" class="priority-input" />
                <div class="muted" id="mrrSummary">MRR: $0</div>
              </div>
            </div>
          </section>

          <section class="card revenue-chart-card">
            <div class="section-title"><span>Revenue (Last 6 Months)</span></div>
            <canvas id="revenueChart" height="240"></canvas>
          </section>
        </div>

        <section class="card revenue-clients-card">
          <div class="section-title">
            <span>Clients</span>
            <button class="button" id="addClientBtn">+ Add Client</button>
          </div>
          <div class="clients-list" id="clientsList"></div>
        </section>

        <section class="card revenue-projection-card">
          <div class="section-title"><span>Revenue Projections</span></div>
          <div class="projection-grid">
            <div class="projection-item"><small class="muted">Projected Annual @ current MRR</small><h3 id="projectedAnnual">$0</h3></div>
            <div class="projection-item"><small class="muted">Gap to Monthly Goal</small><h3 id="goalGap">$0</h3></div>
            <div class="projection-item"><small class="muted">Monthly Growth Needed (6 months)</small><h3 id="growthNeeded">0%</h3></div>
          </div>
        </section>
      </section>

      <!-- COMMAND CENTER TAB -->
      <section class="tab-pane" id="tab-command">
        <section class="card command-center-card">
          <div class="section-title"><span>AI Agents / Team</span></div>
          <div class="agents-grid" id="agentsGrid"></div>
        </section>

        <section class="card decisions-card">
          <div class="section-title"><span>Executive Decisions</span></div>
          <div id="decisionsList"></div>
        </section>
      </section>

      <!-- YOUTUBE TAB -->
      <section class="tab-pane" id="tab-youtube">
        <section class="card yt-ideas-card">
          <div class="section-title">
            <span>Video Ideas Pipeline</span>
            <button class="button" id="addIdeaBtn">+ Add Idea</button>
          </div>
          <div class="yt-pipeline" id="ytPipeline"></div>
        </section>

        <section class="yt-growth-grid">
          <section class="card yt-growth-card">
            <div class="section-title"><span>YouTube Growth Tracker</span></div>
            <div class="yt-growth-controls">
              <label class="muted">Current Subscribers</label>
              <input id="subCountInput" type="number" min="0" step="1" class="priority-input" />
              <div class="muted" id="milestoneLabel">Milestone</div>
            </div>
            <div class="xp-wrap">
              <div class="xp-bar"><div id="xpBarFill"></div></div>
              <small class="muted" id="xpProgressText">0%</small>
            </div>
          </section>

          <section class="card yt-calendar-card">
            <div class="section-title"><span>Content Calendar</span><span id="calendarMonthLabel" class="muted"></span></div>
            <div class="yt-calendar-grid" id="ytCalendarGrid"></div>
          </section>
        </section>
      </section>

      <!-- MEETINGS TAB -->
      <section class="tab-pane" id="tab-meetings">
        <section class="card meetings-today-card">
          <div class="section-title">
            <span>Today's Meetings</span>
            <button class="button" id="addMeetingBtn">+ Add Meeting</button>
          </div>
          <div id="todayMeetingsList"></div>
        </section>

        <section class="card meetings-upcoming-card">
          <div class="section-title"><span>Upcoming Meetings</span></div>
          <div id="upcomingMeetingsList"></div>
        </section>

        <section class="card meetings-past-card">
          <div class="section-title"><span>Past Meetings Archive</span></div>
          <div id="pastMeetingsList"></div>
        </section>
      </section>

      <!-- NOTES TAB -->
      <section class="tab-pane" id="tab-notes">
        <div class="card notes-wrap">
          <h3 class="section-title">Personal Notes</h3>
          <textarea id="notesInput" placeholder="# Ideas\n\n- ..."></textarea>
          <div class="notes-meta">
            <span id="charCount">0 chars</span>
            <span id="lastSaved">Not saved yet</span>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- AGENT DETAIL PANEL -->
  <aside class="agent-panel" id="agentPanel">
    <div class="agent-panel-head">
      <h3 id="agentPanelName" style="margin:0;">Agent</h3>
      <button class="button" id="closeAgentPanelBtn">Close</button>
    </div>
    <p class="muted" id="agentPanelRole"></p>
    <p id="agentPanelDescription"></p>

    <h4 style="margin-bottom:.4rem;">Capabilities</h4>
    <ul id="agentCapabilities" class="panel-list"></ul>

    <h4 style="margin-bottom:.4rem;">Recent Activity</h4>
    <div id="agentActivityLog" class="panel-log"></div>

    <h4 style="margin-bottom:.4rem;">Performance Notes</h4>
    <div id="agentPerformanceNotes" class="panel-notes"></div>

    <button class="button" id="openSendTaskBtn" style="margin-top:1rem;">Send Task</button>
  </aside>

  <!-- SEND TASK MODAL -->
  <div class="modal-backdrop" id="sendTaskModalBackdrop">
    <div class="modal">
      <h3 id="sendTaskTitle" style="margin-top:0;">Send Task</h3>
      <div class="field">
        <label>Task Instructions</label>
        <textarea id="sendTaskTextarea" rows="5" maxlength="800" placeholder="Describe the task clearly..."></textarea>
      </div>
      <div class="modal-actions">
        <button class="button" id="cancelSendTaskBtn">Cancel</button>
        <button class="button" id="confirmSendTaskBtn">Send</button>
      </div>
    </div>
  </div>

  <!-- MEETING MODAL -->
  <div class="modal-backdrop" id="meetingModalBackdrop">
    <div class="modal">
      <h3 id="meetingModalTitle" style="margin-top:0;">Add Meeting</h3>
      <div class="field"><label>Title</label><input id="meetingTitleInput" maxlength="120" /></div>
      <div class="field"><label>Date & Time</label><input id="meetingDateInput" type="datetime-local" /></div>
      <div class="field"><label>Attendees</label><input id="meetingAttendeesInput" maxlength="180" placeholder="Chumi, Team, Client" /></div>
      <div class="field"><label>Type</label>
        <select id="meetingTypeInput">
          <option value="call">Call</option>
          <option value="zoom">Zoom</option>
          <option value="in-person">In-person</option>
        </select>
      </div>
      <div class="field"><label>Prep Notes</label><textarea id="meetingPrepInput" rows="3" maxlength="500"></textarea></div>
      <div class="modal-actions">
        <button class="button" id="cancelMeetingBtn">Cancel</button>
        <button class="button danger" id="deleteMeetingBtn" style="display:none;">Delete</button>
        <button class="button" id="saveMeetingBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- VIDEO IDEA MODAL -->
  <div class="modal-backdrop" id="ideaModalBackdrop">
    <div class="modal">
      <h3 id="ideaModalTitle" style="margin-top:0;">Add Video Idea</h3>
      <div class="field"><label>Title</label><input id="ideaTitleInput" maxlength="120" /></div>
      <div class="field"><label>Topic</label><input id="ideaTopicInput" maxlength="120" /></div>
      <div class="field"><label>Status</label>
        <select id="ideaStatusInput">
          <option value="idea">Idea</option>
          <option value="scripting">Scripting</option>
          <option value="filming">Filming</option>
          <option value="editing">Editing</option>
          <option value="published">Published</option>
        </select>
      </div>
      <div class="field"><label>Target Publish Date</label><input id="ideaDateInput" type="date" /></div>
      <div class="modal-actions">
        <button class="button" id="cancelIdeaBtn">Cancel</button>
        <button class="button danger" id="deleteIdeaBtn" style="display:none;">Delete</button>
        <button class="button" id="saveIdeaBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- CLIENT MODAL -->
  <div class="modal-backdrop" id="clientModalBackdrop">
    <div class="modal">
      <h3 id="clientModalTitle" style="margin-top:0;">Add Client</h3>
      <div class="field"><label>Name</label><input id="clientNameInput" maxlength="80" /></div>
      <div class="field"><label>Monthly Value (USD)</label><input id="clientValueInput" type="number" min="0" step="50" /></div>
      <div class="field"><label>Status</label>
        <select id="clientStatusInput">
          <option value="active">Active</option>
          <option value="pending">Pending</option>
          <option value="churned">Churned</option>
        </select>
      </div>
      <div class="field"><label>Start Date</label><input id="clientStartInput" type="date" /></div>
      <div class="modal-actions">
        <button class="button" id="cancelClientBtn">Cancel</button>
        <button class="button danger" id="deleteClientBtn" style="display:none;">Delete</button>
        <button class="button" id="saveClientBtn">Save</button>
      </div>
    </div>
  </div>

  <!-- TASK MODAL -->
  <div class="modal-backdrop" id="taskModalBackdrop">
    <div class="modal">
      <h3 id="modalTitle" style="margin-top:0;">Add Task</h3>
      <div class="field">
        <label>Title</label>
        <input id="taskTitleInput" maxlength="80" />
      </div>
      <div class="field">
        <label>Description</label>
        <textarea id="taskDescInput" rows="3" maxlength="240"></textarea>
      </div>
      <div class="field">
        <label>Priority</label>
        <select id="taskPriorityInput">
          <option value="high">High</option>
          <option value="medium" selected>Medium</option>
          <option value="low">Low</option>
        </select>
      </div>
      <div class="field">
        <label>Column</label>
        <select id="taskColumnInput">
          <option value="backlog">Backlog</option>
          <option value="inProgress">In Progress</option>
          <option value="done">Done</option>
        </select>
      </div>
      <div class="modal-actions">
        <button class="button" id="cancelTaskBtn">Cancel</button>
        <button class="button danger" id="deleteTaskBtn" style="display:none;">Delete</button>
        <button class="button" id="saveTaskBtn">Save</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       STORAGE + CONFIG
    ========================== */
    const STORAGE_KEYS = {
      tasks: 'mc_tasks_v1',
      priorities: 'mc_priorities_v1',
      activities: 'mc_activities_v1',
      notes: 'mc_notes_v1',
      notesSavedAt: 'mc_notes_saved_at_v1',
      mvpProgress: 'mc_mvp_progress_v1',
      goalStartDate: 'mc_goal_start_date_v1',
      clients: 'mc_clients_v1',
      revenueGoal: 'mc_revenue_goal_v1',
      agents: 'mc_agents_v1',
      decisions: 'mc_decisions_v1',
      youtubeIdeas: 'mc_youtube_ideas_v1',
      youtubeSubs: 'mc_youtube_subs_v1',
      meetings: 'mc_meetings_v1'
    };

    const timelinePhases = [
      {
        title: 'Phase 1 ‚Äî Foundation',
        range: 'Week 1',
        description: 'Define product scope, architecture and delivery plan for MVP.',
        milestones: [
          { text: 'Problem statement validated', done: true },
          { text: 'Core modules mapped', done: true },
          { text: 'Initial backlog prioritized', done: false }
        ],
        current: true
      },
      {
        title: 'Phase 2 ‚Äî Build Sprint',
        range: 'Week 2-3',
        description: 'Develop core workflows, dashboard and operational controls.',
        milestones: [
          { text: 'Auth + role model', done: false },
          { text: 'Task board functional', done: false },
          { text: 'Executive view online', done: false }
        ],
        current: false
      },
      {
        title: 'Phase 3 ‚Äî Polish + Launch',
        range: 'Week 4',
        description: 'QA hardening, bug fixes, deployment and go-live rituals.',
        milestones: [
          { text: 'Smoke tests pass', done: false },
          { text: 'Pilot usage with team', done: false },
          { text: 'MVP functional release', done: false }
        ],
        current: false
      }
    ];

    const defaultState = {
      tasks: {
        backlog: [
          { id: crypto.randomUUID(), title: 'Define MVP acceptance checklist', description: 'Set clear criteria for MVP funcional delivery.', priority: 'high', createdAt: new Date().toISOString() }
        ],
        inProgress: [
          { id: crypto.randomUUID(), title: 'Build PM core workflow', description: 'Scope projects, statuses and owners.', priority: 'medium', createdAt: new Date().toISOString() }
        ],
        done: []
      },
      priorities: [
        { id: crypto.randomUUID(), text: 'Ship MVP functional within one month', checked: false },
        { id: crypto.randomUUID(), text: 'Track daily execution discipline', checked: true }
      ],
      activities: [
        { id: crypto.randomUUID(), text: 'Mission Control initialized', timestamp: new Date().toISOString() }
      ],
      clients: [
        { id: crypto.randomUUID(), name: 'Le Funk Core', monthlyValue: 3500, status: 'active', startDate: new Date().toISOString().slice(0,10) },
        { id: crypto.randomUUID(), name: 'Pilot Client', monthlyValue: 1200, status: 'pending', startDate: new Date().toISOString().slice(0,10) }
      ],
      agents: [
        {
          id: crypto.randomUUID(),
          name: 'Atlas', role: 'Product Strategist', status: 'online', model: 'GPT-5.3 Codex',
          lastActive: new Date().toISOString(),
          description: 'Converts business goals into executable product plans and milestones.',
          capabilities: ['Roadmapping', 'Scope definition', 'Risk triage'],
          performanceNotes: 'Excellent at clarity and prioritization under time pressure.',
          activity: [
            { text: 'Mapped MVP scope into 4 deliverables', timestamp: new Date().toISOString() },
            { text: 'Reviewed sprint sequencing', timestamp: new Date().toISOString() }
          ]
        },
        {
          id: crypto.randomUUID(),
          name: 'Nyx', role: 'UX Systems Lead', status: 'busy', model: 'Claude Opus 4.6',
          lastActive: new Date().toISOString(),
          description: 'Designs high-clarity flows and visual systems for executive and team operations.',
          capabilities: ['UX architecture', 'Design systems', 'Mobile-first layout'],
          performanceNotes: 'Strong user empathy; occasionally needs tighter time-boxing.',
          activity: [{ text: 'Improved control dashboard hierarchy', timestamp: new Date().toISOString() }]
        },
        {
          id: crypto.randomUUID(),
          name: 'Volt', role: 'Automation Engineer', status: 'online', model: 'GPT-4.1',
          lastActive: new Date().toISOString(),
          description: 'Builds integrations, automations and guardrails for reliable execution.',
          capabilities: ['APIs', 'CI/CD', 'Monitoring hooks'],
          performanceNotes: 'Fast and reliable, especially in repetitive flows.',
          activity: [{ text: 'Automated release checklist execution', timestamp: new Date().toISOString() }]
        },
        {
          id: crypto.randomUUID(),
          name: 'Echo', role: 'Ops Analyst', status: 'offline', model: 'Gemini 1.5 Pro',
          lastActive: new Date(Date.now()-1000*60*90).toISOString(),
          description: 'Tracks operational quality, anomalies and recommends corrective actions.',
          capabilities: ['KPI analysis', 'Incident summaries', 'QA checks'],
          performanceNotes: 'Very thorough reporting; best when fed clean telemetry.',
          activity: [{ text: 'Generated weekly ops health summary', timestamp: new Date(Date.now()-1000*60*120).toISOString() }]
        }
      ],
      decisions: [
        {
          id: crypto.randomUUID(),
          date: new Date().toISOString().slice(0,10),
          question: 'Should we prioritize PM core workflow over advanced analytics?',
          summary: 'Yes. Focus on core PM workflow first to secure MVP adoption velocity.',
          consultedAgents: ['Atlas', 'Nyx']
        },
        {
          id: crypto.randomUUID(),
          date: new Date().toISOString().slice(0,10),
          question: 'Do we invest this week in automation or UI polish?',
          summary: 'Split 70/30 toward automation to reduce execution risk and rework.',
          consultedAgents: ['Volt', 'Echo']
        }
      ],
      youtubeIdeas: [
        { id: crypto.randomUUID(), title: 'How we ship MVP in 30 days', topic: 'Execution', status: 'idea', targetDate: new Date().toISOString().slice(0,10) },
        { id: crypto.randomUUID(), title: 'Behind the scenes: Le Funk PM', topic: 'Build in public', status: 'scripting', targetDate: new Date(Date.now()+86400000*5).toISOString().slice(0,10) },
        { id: crypto.randomUUID(), title: 'Dashboard deep dive', topic: 'Product demo', status: 'editing', targetDate: new Date(Date.now()+86400000*10).toISOString().slice(0,10) }
      ],
      meetings: [
        {
          id: crypto.randomUUID(),
          title: 'Weekly PM Sync',
          datetime: new Date(Date.now()+3600*1000).toISOString().slice(0,16),
          attendees: 'Chumi, Product Team',
          type: 'zoom',
          prepNotes: 'Review sprint blockers and release dates.',
          agenda: [
            { id: crypto.randomUUID(), text: 'Check sprint health', done: false },
            { id: crypto.randomUUID(), text: 'Confirm owner per blocker', done: false }
          ],
          notes: '',
          actionItems: ''
        },
        {
          id: crypto.randomUUID(),
          title: 'Client Strategy Call',
          datetime: new Date(Date.now()+86400000*2).toISOString().slice(0,16),
          attendees: 'Chumi, Client Lead',
          type: 'call',
          prepNotes: 'Bring metrics and roadmap snapshot.',
          agenda: [{ id: crypto.randomUUID(), text: 'Present monthly growth plan', done: false }],
          notes: '',
          actionItems: ''
        }
      ]
    };

    /* =========================
       UTILITIES
    ========================== */
    const $ = (sel) => document.querySelector(sel);
    const formatDate = (iso) => new Date(iso).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' });

    function load(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : fallback;
      } catch { return fallback; }
    }

    function save(key, value) { localStorage.setItem(key, JSON.stringify(value)); }

    function addActivity(text) {
      const activities = load(STORAGE_KEYS.activities, defaultState.activities);
      activities.unshift({ id: crypto.randomUUID(), text, timestamp: new Date().toISOString() });
      save(STORAGE_KEYS.activities, activities.slice(0, 150));
      renderActivityFeed();
    }

    /* =========================
       TAB NAVIGATION
    ========================== */
    document.querySelectorAll('.tab-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        $(`#tab-${btn.dataset.tab}`).classList.add('active');
      });
    });

    /* =========================
       WELCOME + CLOCK
    ========================== */
    function updateWelcomeClock() {
      const now = new Date();
      const hour = now.getHours();
      const part = hour < 12 ? 'morning' : hour < 18 ? 'afternoon' : 'evening';
      $('#welcomeText').textContent = `Good ${part}, Chumi`;
      $('#liveDateTime').textContent = now.toLocaleString([], {
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
        hour: 'numeric', minute: '2-digit'
      });
    }
    setInterval(updateWelcomeClock, 1000);
    updateWelcomeClock();

    /* =========================
       PRIORITIES
    ========================== */
    function getPriorities() { return load(STORAGE_KEYS.priorities, defaultState.priorities); }

    function renderPriorities() {
      const priorities = getPriorities();
      const root = $('#priorityList');
      root.innerHTML = '';

      priorities.forEach((p) => {
        const row = document.createElement('div');
        row.className = 'priority-item';
        row.innerHTML = `
          <input type="checkbox" ${p.checked ? 'checked' : ''} />
          <input class="priority-input" value="${p.text.replace(/"/g, '&quot;')}" />
          <button class="button" title="Delete">‚úï</button>
        `;

        const [chk, input, del] = row.children;
        chk.addEventListener('change', () => {
          p.checked = chk.checked;
          save(STORAGE_KEYS.priorities, priorities);
          addActivity(`Priority ${p.checked ? 'completed' : 'reopened'}: ${p.text}`);
          renderMetrics();
        });

        input.addEventListener('change', () => {
          p.text = input.value.trim() || p.text;
          save(STORAGE_KEYS.priorities, priorities);
          addActivity('Priority updated');
        });

        del.addEventListener('click', () => {
          const next = priorities.filter(x => x.id !== p.id);
          save(STORAGE_KEYS.priorities, next);
          addActivity('Priority removed');
          renderPriorities();
          renderMetrics();
        });

        root.appendChild(row);
      });
    }

    $('#addPriorityBtn').addEventListener('click', () => {
      const priorities = getPriorities();
      priorities.push({ id: crypto.randomUUID(), text: 'New priority', checked: false });
      save(STORAGE_KEYS.priorities, priorities);
      addActivity('New priority added');
      renderPriorities();
      renderMetrics();
    });

    /* =========================
       ACTIVITY FEED
    ========================== */
    function renderActivityFeed() {
      const items = load(STORAGE_KEYS.activities, defaultState.activities);
      const root = $('#activityFeed');
      root.innerHTML = items.length
        ? items.map(item => `
          <div class="feed-item">
            <div>${item.text}</div>
            <small class="muted">${formatDate(item.timestamp)}</small>
          </div>
        `).join('')
        : `<div class="muted">No activity yet.</div>`;
    }

    /* =========================
       KANBAN PROJECTS
    ========================== */
    const columnMap = {
      backlog: 'Backlog',
      inProgress: 'In Progress',
      done: 'Done'
    };

    function getTasks() { return load(STORAGE_KEYS.tasks, defaultState.tasks); }
    function setTasks(v) { save(STORAGE_KEYS.tasks, v); }

    let editingTask = null;

    function openTaskModal(task = null, preferredColumn = 'backlog') {
      editingTask = task;
      $('#taskModalBackdrop').classList.add('open');
      $('#modalTitle').textContent = task ? 'Edit Task' : 'Add Task';
      $('#deleteTaskBtn').style.display = task ? 'inline-block' : 'none';
      $('#taskTitleInput').value = task?.title || '';
      $('#taskDescInput').value = task?.description || '';
      $('#taskPriorityInput').value = task?.priority || 'medium';
      $('#taskColumnInput').value = task?.column || preferredColumn;
      $('#taskTitleInput').focus();
    }

    function closeTaskModal() {
      $('#taskModalBackdrop').classList.remove('open');
      editingTask = null;
    }

    function renderKanban() {
      const tasks = getTasks();
      const root = $('#kanbanBoard');
      root.innerHTML = '';

      Object.entries(columnMap).forEach(([key, label], i) => {
        const col = document.createElement('section');
        col.className = 'kanban-col card';
        col.style.animationDelay = `${i * 80}ms`;

        const cards = (tasks[key] || []).map(task => `
          <article class="task" data-id="${task.id}" data-column="${key}">
            <h4>${task.title}</h4>
            <p>${task.description || 'No description'}</p>
            <div class="task-meta">
              <span class="badge ${task.priority}">${task.priority}</span>
              <span>${new Date(task.createdAt).toLocaleDateString()}</span>
            </div>
          </article>
        `).join('');

        col.innerHTML = `
          <div class="kanban-head">
            <strong>${label} <span class="muted">(${(tasks[key] || []).length})</span></strong>
            <button class="button" data-add="${key}">+ Add</button>
          </div>
          ${cards || '<div class="muted">No tasks</div>'}
        `;

        root.appendChild(col);
      });

      root.querySelectorAll('[data-add]').forEach(btn => {
        btn.addEventListener('click', () => openTaskModal(null, btn.dataset.add));
      });

      root.querySelectorAll('.task').forEach(el => {
        el.addEventListener('click', () => {
          const tasks = getTasks();
          const column = el.dataset.column;
          const task = tasks[column].find(t => t.id === el.dataset.id);
          openTaskModal({ ...task, column }, column);
        });
      });

      renderMetrics();
    }

    $('#cancelTaskBtn').addEventListener('click', closeTaskModal);
    $('#taskModalBackdrop').addEventListener('click', (e) => {
      if (e.target.id === 'taskModalBackdrop') closeTaskModal();
    });

    $('#saveTaskBtn').addEventListener('click', () => {
      const title = $('#taskTitleInput').value.trim();
      if (!title) return;

      const payload = {
        title,
        description: $('#taskDescInput').value.trim(),
        priority: $('#taskPriorityInput').value,
        column: $('#taskColumnInput').value
      };

      const tasks = getTasks();

      if (editingTask) {
        Object.keys(tasks).forEach(col => {
          tasks[col] = tasks[col].filter(t => t.id !== editingTask.id);
        });

        tasks[payload.column].unshift({
          id: editingTask.id,
          title: payload.title,
          description: payload.description,
          priority: payload.priority,
          createdAt: editingTask.createdAt
        });
        addActivity(`Task updated: ${payload.title}`);
      } else {
        tasks[payload.column].unshift({
          id: crypto.randomUUID(),
          title: payload.title,
          description: payload.description,
          priority: payload.priority,
          createdAt: new Date().toISOString()
        });
        addActivity(`Task created: ${payload.title}`);
      }

      setTasks(tasks);
      renderKanban();
      closeTaskModal();
    });

    $('#deleteTaskBtn').addEventListener('click', () => {
      if (!editingTask) return;
      const tasks = getTasks();
      Object.keys(tasks).forEach(col => {
        tasks[col] = tasks[col].filter(t => t.id !== editingTask.id);
      });
      setTasks(tasks);
      addActivity(`Task deleted: ${editingTask.title}`);
      renderKanban();
      closeTaskModal();
    });

    /* =========================
       TIMELINE
    ========================== */
    function renderTimeline() {
      const root = $('#timelineContainer');
      root.innerHTML = timelinePhases.map((phase) => `
        <article class="phase card ${phase.current ? 'current' : ''}">
          <h3 style="margin:.1rem 0 .35rem;">${phase.title}</h3>
          <div class="muted" style="margin-bottom:.5rem;">${phase.range}</div>
          <p style="margin:0;">${phase.description}</p>
          <ul class="milestones">
            ${phase.milestones.map(m => `<li>${m.done ? '‚úÖ' : '‚¨ú'} ${m.text}</li>`).join('')}
          </ul>
        </article>
      `).join('');
    }

    /* =========================
       NOTES
    ========================== */
    const notesInput = $('#notesInput');

    function renderNotesMeta() {
      const text = notesInput.value;
      $('#charCount').textContent = `${text.length} chars`;
      const savedAt = localStorage.getItem(STORAGE_KEYS.notesSavedAt);
      $('#lastSaved').textContent = savedAt ? `Last saved: ${formatDate(savedAt)}` : 'Not saved yet';
    }

    notesInput.addEventListener('input', () => {
      localStorage.setItem(STORAGE_KEYS.notes, notesInput.value);
      localStorage.setItem(STORAGE_KEYS.notesSavedAt, new Date().toISOString());
      renderNotesMeta();
    });

    /* =========================
       METRICS
    ========================== */
    function renderMetrics() {
      const tasks = getTasks();
      const allTasks = [...tasks.backlog, ...tasks.inProgress, ...tasks.done];
      const activeProjects = tasks.backlog.length + tasks.inProgress.length;

      const today = new Date().toDateString();
      const doneToday = tasks.done.filter(t => new Date(t.createdAt).toDateString() === today).length;

      let mvp = Number(localStorage.getItem(STORAGE_KEYS.mvpProgress));
      if (!Number.isFinite(mvp)) {
        const total = allTasks.length || 1;
        mvp = Math.round((tasks.done.length / total) * 100);
        localStorage.setItem(STORAGE_KEYS.mvpProgress, String(mvp));
      }

      const goalStartRaw = localStorage.getItem(STORAGE_KEYS.goalStartDate);
      const startDate = goalStartRaw ? new Date(goalStartRaw) : new Date();
      if (!goalStartRaw) localStorage.setItem(STORAGE_KEYS.goalStartDate, startDate.toISOString());
      const endDate = new Date(startDate.getTime() + (30 * 24 * 60 * 60 * 1000));
      const daysRemaining = Math.max(0, Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24)));

      $('#mvpValue').textContent = `${mvp}%`;
      $('#mvpTrend').textContent = `${mvp >= 50 ? '+' : ''}${mvp - 45}%`;
      $('#projectsValue').textContent = activeProjects;
      $('#tasksTodayValue').textContent = doneToday;
      $('#tasksTrend').textContent = `+${doneToday}`;
      $('#daysGoalValue').textContent = daysRemaining;
    }

    /* =========================
       COMMAND CENTER
    ========================== */
    let activeAgentId = null;

    function getAgents() { return load(STORAGE_KEYS.agents, defaultState.agents); }
    function setAgents(v) { save(STORAGE_KEYS.agents, v); }
    function getDecisions() { return load(STORAGE_KEYS.decisions, defaultState.decisions); }

    function renderAgents() {
      const agents = getAgents();
      const grid = $('#agentsGrid');
      if (!grid) return;
      grid.innerHTML = agents.map(a => `
        <article class="agent-card" data-agent-id="${a.id}">
          <div class="agent-head">
            <strong>${a.name}</strong>
            <span class="agent-status"><span class="dot ${a.status}"></span>${a.status}</span>
          </div>
          <div class="agent-role">${a.role}</div>
          <div class="agent-meta">
            <span>${a.model}</span>
            <span>${formatDate(a.lastActive)}</span>
          </div>
        </article>
      `).join('');

      grid.querySelectorAll('[data-agent-id]').forEach(card => {
        card.addEventListener('click', () => openAgentPanel(card.dataset.agentId));
      });
    }

    function renderDecisions() {
      const decisions = getDecisions();
      const root = $('#decisionsList');
      if (!root) return;
      root.innerHTML = decisions.map(d => `
        <article class="decision-item">
          <small>${d.date}</small>
          <h4 style="margin:.35rem 0;">${d.question}</h4>
          <p style="margin:.2rem 0;">${d.summary}</p>
          <small>Consulted: ${d.consultedAgents.join(', ')}</small>
        </article>
      `).join('');
    }

    function openAgentPanel(agentId) {
      activeAgentId = agentId;
      const agent = getAgents().find(a => a.id === agentId);
      if (!agent) return;
      $('#agentPanelName').textContent = agent.name;
      $('#agentPanelRole').textContent = `${agent.role} ¬∑ ${agent.model}`;
      $('#agentPanelDescription').textContent = agent.description;
      $('#agentCapabilities').innerHTML = (agent.capabilities || []).map(c => `<li>${c}</li>`).join('');
      $('#agentPerformanceNotes').textContent = agent.performanceNotes || '‚Äî';
      $('#agentActivityLog').innerHTML = (agent.activity || []).slice(0,8).map(i => `
        <div class="panel-log-item">
          <div>${i.text}</div>
          <small class="muted">${formatDate(i.timestamp)}</small>
        </div>
      `).join('');
      $('#agentPanel').classList.add('open');
      $('#sendTaskTitle').textContent = `Send Task ‚Äî ${agent.name}`;
    }

    function closeAgentPanel() { $('#agentPanel').classList.remove('open'); }

    $('#closeAgentPanelBtn').addEventListener('click', closeAgentPanel);
    $('#openSendTaskBtn').addEventListener('click', () => {
      if (!activeAgentId) return;
      $('#sendTaskTextarea').value = '';
      $('#sendTaskModalBackdrop').classList.add('open');
      $('#sendTaskTextarea').focus();
    });

    $('#cancelSendTaskBtn').addEventListener('click', () => $('#sendTaskModalBackdrop').classList.remove('open'));
    $('#sendTaskModalBackdrop').addEventListener('click', (e) => { if (e.target.id === 'sendTaskModalBackdrop') $('#sendTaskModalBackdrop').classList.remove('open'); });

    $('#confirmSendTaskBtn').addEventListener('click', () => {
      const text = $('#sendTaskTextarea').value.trim();
      if (!text || !activeAgentId) return;
      const agents = getAgents();
      const idx = agents.findIndex(a => a.id === activeAgentId);
      if (idx === -1) return;
      agents[idx].activity = agents[idx].activity || [];
      agents[idx].activity.unshift({ text: `Task assigned: ${text}`, timestamp: new Date().toISOString() });
      agents[idx].lastActive = new Date().toISOString();
      agents[idx].status = 'busy';
      setAgents(agents);
      addActivity(`Task sent to ${agents[idx].name}`);
      $('#sendTaskModalBackdrop').classList.remove('open');
      renderAgents();
      openAgentPanel(activeAgentId);
    });

    /* =========================
       REVENUE
    ========================== */
    const revenueGoalInput = $('#revenueGoalInput');
    let editingClient = null;

    function getClients() { return load(STORAGE_KEYS.clients, defaultState.clients); }
    function setClients(v) { save(STORAGE_KEYS.clients, v); }
    function money(n) { return `$${Number(n||0).toLocaleString()}`; }

    function getMRR() {
      return getClients().filter(c => c.status === 'active').reduce((sum, c) => sum + Number(c.monthlyValue || 0), 0);
    }

    function drawRevenueChart() {
      const canvas = $('#revenueChart');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const dpr = window.devicePixelRatio || 1;
      const w = canvas.clientWidth || 500;
      const h = canvas.height;
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      ctx.scale(dpr, dpr);
      ctx.clearRect(0, 0, w, h);

      const mrr = getMRR();
      const months = Array.from({length:6}, (_,i)=>{
        const d=new Date(); d.setMonth(d.getMonth()-(5-i));
        return d.toLocaleDateString([], {month:'short'});
      });
      const vals = months.map((_,i)=> Math.max(0, Math.round(mrr * (0.72 + i*0.06))));
      const max = Math.max(...vals, 1);
      const pad = 28; const chartH = h - 42; const barW = (w - pad*2) / vals.length * 0.58;

      vals.forEach((v,i)=>{
        const slot = (w - pad*2) / vals.length;
        const x = pad + i*slot + (slot-barW)/2;
        const bh = (v/max) * (chartH - 28);
        const y = chartH - bh;
        ctx.fillStyle = 'rgba(255,255,255,0.08)';
        ctx.fillRect(x, y, barW, bh);
        const grad = ctx.createLinearGradient(0,y,0,chartH);
        grad.addColorStop(0, '#8B5CF6'); grad.addColorStop(1, 'rgba(139,92,246,.3)');
        ctx.fillStyle = grad; ctx.fillRect(x, y + bh*0.25, barW, bh*0.75);
        ctx.fillStyle = '#a5a6b8'; ctx.font = '12px Inter'; ctx.textAlign = 'center';
        ctx.fillText(months[i], x + barW/2, h - 12);
      });
    }

    function renderRevenue() {
      const clients = getClients();
      const list = $('#clientsList');
      list.innerHTML = clients.length ? clients.map(c => `
        <div class="client-row">
          <strong>${c.name}</strong>
          <span>${money(c.monthlyValue)}</span>
          <span class="status-pill ${c.status}">${c.status}</span>
          <span class="muted">${c.startDate || '-'}</span>
          <button class="button" data-client="${c.id}">Edit</button>
        </div>
      `).join('') : '<div class="muted">No clients yet.</div>';

      list.querySelectorAll('[data-client]').forEach(btn => {
        btn.addEventListener('click', () => {
          const client = clients.find(c => c.id === btn.dataset.client);
          openClientModal(client);
        });
      });

      const mrr = getMRR();
      const goal = Number(localStorage.getItem(STORAGE_KEYS.revenueGoal)) || 10000;
      const pct = goal ? Math.min(100, Math.round((mrr/goal)*100)) : 0;
      $('#goalGauge').style.setProperty('--deg', `${Math.round((pct/100)*360)}deg`);
      $('#goalGaugeLabel').textContent = `${pct}%`;
      $('#mrrSummary').textContent = `MRR: ${money(mrr)}`;
      revenueGoalInput.value = goal;

      const annual = mrr * 12;
      const gap = Math.max(0, goal - mrr);
      const growthNeeded = mrr > 0 && goal > mrr ? ((Math.pow(goal / mrr, 1 / 6) - 1) * 100) : 0;
      $('#projectedAnnual').textContent = money(annual);
      $('#goalGap').textContent = money(gap);
      $('#growthNeeded').textContent = `${growthNeeded.toFixed(1)}%`;

      drawRevenueChart();
    }

    function openClientModal(client=null) {
      editingClient = client;
      $('#clientModalBackdrop').classList.add('open');
      $('#clientModalTitle').textContent = client ? 'Edit Client' : 'Add Client';
      $('#deleteClientBtn').style.display = client ? 'inline-block' : 'none';
      $('#clientNameInput').value = client?.name || '';
      $('#clientValueInput').value = client?.monthlyValue ?? '';
      $('#clientStatusInput').value = client?.status || 'active';
      $('#clientStartInput').value = client?.startDate || new Date().toISOString().slice(0,10);
    }

    function closeClientModal() {
      editingClient = null;
      $('#clientModalBackdrop').classList.remove('open');
    }

    $('#addClientBtn').addEventListener('click', ()=>openClientModal());
    $('#cancelClientBtn').addEventListener('click', closeClientModal);
    $('#clientModalBackdrop').addEventListener('click', (e)=>{ if (e.target.id==='clientModalBackdrop') closeClientModal(); });

    $('#saveClientBtn').addEventListener('click', ()=>{
      const name = $('#clientNameInput').value.trim();
      if (!name) return;
      const payload = {
        id: editingClient?.id || crypto.randomUUID(),
        name,
        monthlyValue: Number($('#clientValueInput').value || 0),
        status: $('#clientStatusInput').value,
        startDate: $('#clientStartInput').value || new Date().toISOString().slice(0,10)
      };
      let clients = getClients();
      clients = clients.filter(c => c.id !== payload.id);
      clients.unshift(payload);
      setClients(clients);
      addActivity(`Client ${editingClient ? 'updated' : 'added'}: ${payload.name}`);
      renderRevenue();
      closeClientModal();
    });

    $('#deleteClientBtn').addEventListener('click', ()=>{
      if (!editingClient) return;
      setClients(getClients().filter(c => c.id !== editingClient.id));
      addActivity(`Client removed: ${editingClient.name}`);
      renderRevenue();
      closeClientModal();
    });

    revenueGoalInput.addEventListener('change', ()=>{
      localStorage.setItem(STORAGE_KEYS.revenueGoal, String(Number(revenueGoalInput.value || 0)));
      renderRevenue();
    });

    window.addEventListener('resize', drawRevenueChart);

    /* =========================
       YOUTUBE
    ========================== */
    const YT_STATUSES = ['idea','scripting','filming','editing','published'];
    const YT_MILESTONES = [
      { subs: 0, title: 'Starting Signal' },
      { subs: 1000, title: 'Rising Creator' },
      { subs: 10000, title: 'Growth Engine' },
      { subs: 50000, title: 'Audience Magnet' },
      { subs: 100000, title: 'Creator Force' }
    ];

    let editingIdea = null;

    function getYoutubeIdeas() { return load(STORAGE_KEYS.youtubeIdeas, defaultState.youtubeIdeas); }
    function setYoutubeIdeas(v) { save(STORAGE_KEYS.youtubeIdeas, v); }

    function renderYouTubePipeline() {
      const ideas = getYoutubeIdeas();
      const root = $('#ytPipeline');
      if (!root) return;
      root.innerHTML = YT_STATUSES.map(st => {
        const cards = ideas.filter(i => i.status === st).map(i => `
          <article class="idea-card" data-idea-id="${i.id}">
            <strong>${i.title}</strong>
            <p>${i.topic}</p>
            <small>Target: ${i.targetDate || '‚Äî'}</small>
          </article>
        `).join('');

        return `
          <div class="yt-col">
            <div class="yt-col-head">
              <h4>${st}</h4>
              <button class="button" data-add-idea="${st}">+ Add</button>
            </div>
            ${cards || '<small class="muted">No items</small>'}
          </div>
        `;
      }).join('');

      root.querySelectorAll('[data-add-idea]').forEach(btn => btn.addEventListener('click', () => openIdeaModal(null, btn.dataset.addIdea)));
      root.querySelectorAll('[data-idea-id]').forEach(card => {
        card.addEventListener('click', () => {
          const idea = ideas.find(x => x.id === card.dataset.ideaId);
          openIdeaModal(idea, idea?.status || 'idea');
        });
      });
    }

    function renderGrowthTracker() {
      const subs = Number(localStorage.getItem(STORAGE_KEYS.youtubeSubs) || 0);
      $('#subCountInput').value = subs;

      let current = YT_MILESTONES[0], next = YT_MILESTONES[1] || YT_MILESTONES[0];
      for (let i=0;i<YT_MILESTONES.length;i++) {
        if (subs >= YT_MILESTONES[i].subs) current = YT_MILESTONES[i];
        if (subs < YT_MILESTONES[i].subs) { next = YT_MILESTONES[i]; break; }
        if (i === YT_MILESTONES.length-1) next = YT_MILESTONES[i];
      }

      const span = Math.max(1, next.subs - current.subs);
      const pct = next.subs === current.subs ? 100 : Math.min(100, ((subs - current.subs) / span) * 100);
      $('#xpBarFill').style.width = `${pct}%`;
      $('#milestoneLabel').textContent = `Current: ${current.title} ¬∑ Next: ${next.title} (${next.subs.toLocaleString()} subs)`;
      $('#xpProgressText').textContent = `${Math.round(pct)}% to next milestone`;
    }

    function renderContentCalendar() {
      const ideas = getYoutubeIdeas();
      const root = $('#ytCalendarGrid');
      if (!root) return;

      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const first = new Date(year, month, 1);
      const last = new Date(year, month + 1, 0);
      const startDow = first.getDay();
      const days = last.getDate();

      $('#calendarMonthLabel').textContent = now.toLocaleDateString([], { month: 'long', year: 'numeric' });

      const dayLabels = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const cells = [];
      dayLabels.forEach(d => cells.push(`<div class="yt-day muted" style="min-height:28px;display:grid;place-items:center;">${d}</div>`));
      for (let i=0;i<startDow;i++) cells.push('<div class="yt-day" style="opacity:.35"></div>');

      for (let d=1; d<=days; d++) {
        const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        const vids = ideas.filter(i => i.targetDate === dateStr);
        cells.push(`
          <div class="yt-day ${vids.length ? 'has-video' : ''}">
            <span class="d">${d}</span>
            ${vids.slice(0,2).map(v => `<span class="v">üé¨ ${v.title}</span>`).join('')}
          </div>
        `);
      }
      root.innerHTML = cells.join('');
    }

    function openIdeaModal(idea=null, status='idea') {
      editingIdea = idea;
      $('#ideaModalBackdrop').classList.add('open');
      $('#ideaModalTitle').textContent = idea ? 'Edit Video Idea' : 'Add Video Idea';
      $('#deleteIdeaBtn').style.display = idea ? 'inline-block' : 'none';
      $('#ideaTitleInput').value = idea?.title || '';
      $('#ideaTopicInput').value = idea?.topic || '';
      $('#ideaStatusInput').value = idea?.status || status;
      $('#ideaDateInput').value = idea?.targetDate || new Date().toISOString().slice(0,10);
    }

    function closeIdeaModal() { editingIdea = null; $('#ideaModalBackdrop').classList.remove('open'); }

    $('#addIdeaBtn').addEventListener('click', () => openIdeaModal());
    $('#cancelIdeaBtn').addEventListener('click', closeIdeaModal);
    $('#ideaModalBackdrop').addEventListener('click', (e) => { if (e.target.id === 'ideaModalBackdrop') closeIdeaModal(); });

    $('#saveIdeaBtn').addEventListener('click', () => {
      const title = $('#ideaTitleInput').value.trim();
      if (!title) return;
      const payload = {
        id: editingIdea?.id || crypto.randomUUID(),
        title,
        topic: $('#ideaTopicInput').value.trim() || 'General',
        status: $('#ideaStatusInput').value,
        targetDate: $('#ideaDateInput').value || new Date().toISOString().slice(0,10)
      };
      let ideas = getYoutubeIdeas().filter(i => i.id !== payload.id);
      ideas.unshift(payload);
      setYoutubeIdeas(ideas);
      addActivity(`YouTube idea ${editingIdea ? 'updated' : 'added'}: ${payload.title}`);
      closeIdeaModal();
      renderYouTubePipeline();
      renderContentCalendar();
    });

    $('#deleteIdeaBtn').addEventListener('click', () => {
      if (!editingIdea) return;
      setYoutubeIdeas(getYoutubeIdeas().filter(i => i.id !== editingIdea.id));
      addActivity(`YouTube idea removed: ${editingIdea.title}`);
      closeIdeaModal();
      renderYouTubePipeline();
      renderContentCalendar();
    });

    $('#subCountInput').addEventListener('change', () => {
      localStorage.setItem(STORAGE_KEYS.youtubeSubs, String(Number($('#subCountInput').value || 0)));
      renderGrowthTracker();
    });

    function renderYouTube() {
      renderYouTubePipeline();
      renderGrowthTracker();
      renderContentCalendar();
    }

    /* =========================
       MEETINGS
    ========================== */
    let editingMeeting = null;

    function getMeetings() { return load(STORAGE_KEYS.meetings, defaultState.meetings); }
    function setMeetings(v) { save(STORAGE_KEYS.meetings, v); }

    function formatCountdown(targetIso) {
      const diff = new Date(targetIso).getTime() - Date.now();
      if (diff <= 0) return 'Started / passed';
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      return `Starts in ${h}h ${m}m`;
    }

    function isToday(isoLike) {
      const d = new Date(isoLike);
      const n = new Date();
      return d.getFullYear()===n.getFullYear() && d.getMonth()===n.getMonth() && d.getDate()===n.getDate();
    }

    function renderMeetingCard(meeting, isPast=false) {
      const mt = new Date(meeting.datetime);
      const agendaHtml = (meeting.agenda || []).map((a, idx) => `
        <div class="agenda-item">
          <input type="checkbox" data-agenda-check="${meeting.id}" data-agenda-index="${idx}" ${a.done ? 'checked' : ''} />
          <input type="text" data-agenda-text="${meeting.id}" data-agenda-index="${idx}" value="${(a.text||'').replace(/"/g,'&quot;')}" />
        </div>
      `).join('');

      return `
        <article class="meeting-card ${isToday(meeting.datetime) && !isPast ? 'today' : ''}" data-meeting-id="${meeting.id}">
          <div class="meeting-head">
            <div>
              <strong>${meeting.title}</strong>
              <div class="meeting-meta">
                <span class="meeting-pill">${mt.toLocaleString()}</span>
                <span class="meeting-pill">${meeting.attendees || '‚Äî'}</span>
                <span class="meeting-pill">${meeting.type}</span>
              </div>
              <small class="muted">Prep: ${meeting.prepNotes || '‚Äî'}</small>
            </div>
            <div class="meeting-actions">
              ${!isPast ? `<span class="countdown" data-countdown="${meeting.id}">${formatCountdown(meeting.datetime)}</span>` : ''}
              <button class="button" data-toggle-meeting="${meeting.id}">Details</button>
              <button class="button" data-edit-meeting="${meeting.id}">Edit</button>
            </div>
          </div>
          <div class="meeting-expand" id="meeting-expand-${meeting.id}">
            <div class="section-title" style="margin-top:.5rem;"><span>Agenda</span><button class="button" data-add-agenda="${meeting.id}">+ Item</button></div>
            <div class="agenda-list">${agendaHtml || '<small class="muted">No agenda items.</small>'}</div>

            <label class="muted">Meeting Notes</label>
            <textarea class="meeting-textarea" data-meeting-notes="${meeting.id}" placeholder="Write notes from the meeting...">${meeting.notes || ''}</textarea>

            <label class="muted" style="margin-top:.5rem;display:block;">Action Items</label>
            <textarea class="meeting-textarea" data-meeting-actions="${meeting.id}" placeholder="List follow-ups and owners...">${meeting.actionItems || ''}</textarea>
          </div>
        </article>
      `;
    }

    function renderMeetings() {
      const meetings = getMeetings().slice().sort((a,b) => new Date(a.datetime) - new Date(b.datetime));
      const now = Date.now();
      const today = meetings.filter(m => isToday(m.datetime) && new Date(m.datetime).getTime() >= now - 3600000);
      const upcoming = meetings.filter(m => !isToday(m.datetime) && new Date(m.datetime).getTime() >= now);
      const past = meetings.filter(m => new Date(m.datetime).getTime() < now);

      $('#todayMeetingsList').innerHTML = today.length ? today.map(m => renderMeetingCard(m)).join('') : '<div class="muted">No meetings today.</div>';
      $('#upcomingMeetingsList').innerHTML = upcoming.length ? upcoming.map(m => renderMeetingCard(m)).join('') : '<div class="muted">No upcoming meetings.</div>';
      $('#pastMeetingsList').innerHTML = past.length ? past.map(m => renderMeetingCard(m, true)).join('') : '<div class="muted">No past meetings yet.</div>';

      bindMeetingEvents();
    }

    function bindMeetingEvents() {
      document.querySelectorAll('[data-toggle-meeting]').forEach(btn => {
        btn.onclick = () => {
          const id = btn.getAttribute('data-toggle-meeting');
          const panel = document.getElementById(`meeting-expand-${id}`);
          if (panel) panel.classList.toggle('open');
        };
      });

      document.querySelectorAll('[data-edit-meeting]').forEach(btn => {
        btn.onclick = () => {
          const id = btn.getAttribute('data-edit-meeting');
          const meeting = getMeetings().find(m => m.id === id);
          openMeetingModal(meeting);
        };
      });

      document.querySelectorAll('[data-add-agenda]').forEach(btn => {
        btn.onclick = () => {
          const id = btn.getAttribute('data-add-agenda');
          const meetings = getMeetings();
          const idx = meetings.findIndex(m => m.id === id);
          if (idx === -1) return;
          meetings[idx].agenda = meetings[idx].agenda || [];
          meetings[idx].agenda.push({ id: crypto.randomUUID(), text: 'New agenda item', done: false });
          setMeetings(meetings);
          renderMeetings();
        };
      });

      document.querySelectorAll('[data-agenda-check]').forEach(el => {
        el.onchange = () => {
          const id = el.getAttribute('data-agenda-check');
          const i = Number(el.getAttribute('data-agenda-index'));
          const meetings = getMeetings();
          const idx = meetings.findIndex(m => m.id === id);
          if (idx === -1) return;
          if (!meetings[idx].agenda?.[i]) return;
          meetings[idx].agenda[i].done = el.checked;
          setMeetings(meetings);
        };
      });

      document.querySelectorAll('[data-agenda-text]').forEach(el => {
        el.onchange = () => {
          const id = el.getAttribute('data-agenda-text');
          const i = Number(el.getAttribute('data-agenda-index'));
          const meetings = getMeetings();
          const idx = meetings.findIndex(m => m.id === id);
          if (idx === -1 || !meetings[idx].agenda?.[i]) return;
          meetings[idx].agenda[i].text = el.value;
          setMeetings(meetings);
        };
      });

      document.querySelectorAll('[data-meeting-notes]').forEach(el => {
        el.oninput = () => {
          const id = el.getAttribute('data-meeting-notes');
          const meetings = getMeetings();
          const idx = meetings.findIndex(m => m.id === id);
          if (idx === -1) return;
          meetings[idx].notes = el.value;
          setMeetings(meetings);
        };
      });

      document.querySelectorAll('[data-meeting-actions]').forEach(el => {
        el.oninput = () => {
          const id = el.getAttribute('data-meeting-actions');
          const meetings = getMeetings();
          const idx = meetings.findIndex(m => m.id === id);
          if (idx === -1) return;
          meetings[idx].actionItems = el.value;
          setMeetings(meetings);
        };
      });
    }

    function openMeetingModal(meeting=null) {
      editingMeeting = meeting;
      $('#meetingModalBackdrop').classList.add('open');
      $('#meetingModalTitle').textContent = meeting ? 'Edit Meeting' : 'Add Meeting';
      $('#deleteMeetingBtn').style.display = meeting ? 'inline-block' : 'none';
      $('#meetingTitleInput').value = meeting?.title || '';
      $('#meetingDateInput').value = meeting?.datetime || '';
      $('#meetingAttendeesInput').value = meeting?.attendees || '';
      $('#meetingTypeInput').value = meeting?.type || 'call';
      $('#meetingPrepInput').value = meeting?.prepNotes || '';
    }

    function closeMeetingModal() {
      editingMeeting = null;
      $('#meetingModalBackdrop').classList.remove('open');
    }

    $('#addMeetingBtn').addEventListener('click', () => openMeetingModal());
    $('#cancelMeetingBtn').addEventListener('click', closeMeetingModal);
    $('#meetingModalBackdrop').addEventListener('click', (e) => { if (e.target.id === 'meetingModalBackdrop') closeMeetingModal(); });

    $('#saveMeetingBtn').addEventListener('click', () => {
      const title = $('#meetingTitleInput').value.trim();
      const datetime = $('#meetingDateInput').value;
      if (!title || !datetime) return;

      const payload = {
        id: editingMeeting?.id || crypto.randomUUID(),
        title,
        datetime,
        attendees: $('#meetingAttendeesInput').value.trim(),
        type: $('#meetingTypeInput').value,
        prepNotes: $('#meetingPrepInput').value.trim(),
        agenda: editingMeeting?.agenda || [{ id: crypto.randomUUID(), text: 'Kickoff & objectives', done: false }],
        notes: editingMeeting?.notes || '',
        actionItems: editingMeeting?.actionItems || ''
      };

      let meetings = getMeetings().filter(m => m.id !== payload.id);
      meetings.push(payload);
      setMeetings(meetings);
      addActivity(`Meeting ${editingMeeting ? 'updated' : 'added'}: ${payload.title}`);
      closeMeetingModal();
      renderMeetings();
    });

    $('#deleteMeetingBtn').addEventListener('click', () => {
      if (!editingMeeting) return;
      setMeetings(getMeetings().filter(m => m.id !== editingMeeting.id));
      addActivity(`Meeting removed: ${editingMeeting.title}`);
      closeMeetingModal();
      renderMeetings();
    });

    setInterval(() => {
      if ($('#tab-meetings')?.classList.contains('active')) renderMeetings();
    }, 60000);

    /* =========================
       SEARCH + SHORTCUT
    ========================== */
    function runSearch(term) {
      const q = term.trim().toLowerCase();
      if (!q) {
        document.querySelectorAll('.task, .feed-item, .priority-item').forEach(el => {
          el.style.display = '';
        });
        return;
      }

      document.querySelectorAll('.task, .feed-item, .priority-item').forEach(el => {
        const text = el.textContent.toLowerCase();
        el.style.display = text.includes(q) ? '' : 'none';
      });
    }

    $('#searchInput').addEventListener('input', (e) => runSearch(e.target.value));

    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        $('#searchInput').focus();
        $('#searchInput').select();
      }
    });

    /* =========================
       BOOTSTRAP
    ========================== */
    (function init() {
      if (!localStorage.getItem(STORAGE_KEYS.tasks)) save(STORAGE_KEYS.tasks, defaultState.tasks);
      if (!localStorage.getItem(STORAGE_KEYS.priorities)) save(STORAGE_KEYS.priorities, defaultState.priorities);
      if (!localStorage.getItem(STORAGE_KEYS.activities)) save(STORAGE_KEYS.activities, defaultState.activities);
      if (!localStorage.getItem(STORAGE_KEYS.clients)) save(STORAGE_KEYS.clients, defaultState.clients);
      if (!localStorage.getItem(STORAGE_KEYS.revenueGoal)) localStorage.setItem(STORAGE_KEYS.revenueGoal, '10000');
      if (!localStorage.getItem(STORAGE_KEYS.agents)) save(STORAGE_KEYS.agents, defaultState.agents);
      if (!localStorage.getItem(STORAGE_KEYS.decisions)) save(STORAGE_KEYS.decisions, defaultState.decisions);
      if (!localStorage.getItem(STORAGE_KEYS.youtubeIdeas)) save(STORAGE_KEYS.youtubeIdeas, defaultState.youtubeIdeas);
      if (!localStorage.getItem(STORAGE_KEYS.youtubeSubs)) localStorage.setItem(STORAGE_KEYS.youtubeSubs, '850');
      if (!localStorage.getItem(STORAGE_KEYS.meetings)) save(STORAGE_KEYS.meetings, defaultState.meetings);

      notesInput.value = localStorage.getItem(STORAGE_KEYS.notes) || '';

      renderPriorities();
      renderActivityFeed();
      renderKanban();
      renderTimeline();
      renderRevenue();
      renderAgents();
      renderDecisions();
      renderYouTube();
      renderMeetings();
      renderNotesMeta();
      renderMetrics();
    })();
  </script>
</body>
</html>